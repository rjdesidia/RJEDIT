<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RJdesidia Editing Director Id Tool</title>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>

<body>
    <div class="container">
        <!-- Media Pool -->
        <div class="media-pool" id="media-pool">
            <!-- Use any element to open/show the overlay navigation menu -->
            <div style="display: flex; justify-content: space-between; align-items: center; max-height: 5%;">
                <h3>Media Pool</h3>
                <input type="file" id="fileInput" webkitdirectory directory multiple>
            </div>
            <div style="overflow-y: auto; height: calc(100% - 5%); ">
                <div id="fileList"></div>
            </div>
            <div class="name" id="link">
                
                RjEDIT by Denis Serokurov (rjdesidia)
            </div>
        </div>

        <div id="targetElement" class="style1">
            <!-- Viewer -->
            <div class="viewer" id="wiever">
                <div style="display: flex;
                justify-content: space-between;
                align-items: center;
                max-height: 5%;
                background-color: #151517;">
                    <h3  style="margin-left: 10px;">Viewer</h3>
                </div>
                
                <div class="viewer-container">
                    <div><video id="video" style="max-height: 692PX;"></video></div>

                    <!-- progress-bar -->
                    <div class="progress-bar" id="progressBar">
                        <div class="progress-bar-fill" id="progressFill"></div>
                        <div class="loop-area" id="loopArea"></div>
                    </div>
                </div>

                <!-- Controls -->
                <div class="controls">
                    <!-- Button-row -->
                    <div class="button-row">
                        <div style="    display: flex;
                            width: 15%;
                            justify-content: space-around;
                        ">
                            <img id="goToIn" class="navigatin-booton" src="img/end.png" alt=""
                            style="transform: rotate(180deg);">
                        <img id="stepBack" class="navigatin-booton" src="img/fraim.png" alt=""
                            style="transform: rotate(180deg);">
                        <img id="playPause" class="navigatin-booton" src="img/play.png" alt=""
                            style="transform: rotate(0deg);">
                        
                        <img id="stepForward" class="navigatin-booton" src="img/fraim.png" alt=""
                            style="transform: rotate(0deg);">
                        <img id="goToOut" class="navigatin-booton" src="img/end.png" alt=""
                            style="transform: rotate(0deg);">
                        </div>
                        <div style="    display: flex
                        ;
                            width: 15%;
                            justify-content: space-around;
                        ">
                            <img id="toggleLoop" class="navigatin-booton" src="img/loop.png" alt=""
                            style="margin-left: 100px; transform: rotate(0deg);">
                            <img id="setIn" class="navigatin-booton"
                                style=" transform: rotate(180deg);" src="img/loop marc.png" alt="">
                            <img id="setOut" class="navigatin-booton" src="img/loop marc.png" alt=""
                                style="transform: rotate(0deg);">
                        </div>
                    </div>

                    <!-- TC -->
                    <div class="tc" style="align-items: baseline;">
                        <!-- Timecodes -->
                        <div class="timecode-row" style=" display: flex
                        ;
                            align-items: flex-end;
                            justify-content: space-evenly;
                            flex-direction: row;
                            gap: 15px; ">
                            <div id="currentTime">Timecode: 00:00:00:00</div>
                            <div id="inTime">In: --:--:--:--</div>
                            <div id="outTime">Out: --:--:--:--</div>
                            <div style="-webkit-user-select: none;">copy:</div>
                        </div>
                        <!-- Copy Buttons -->
                        <div style="display: flex; ">
                            <button id="copyTC" class="SCB">TC</button>
                            <button id="copyInOut" class="SCB">In/Out</button>
                            <button id="shortcutviver" class="SCB" style="width: 90px; margin-left: 5px;" onclick="openSC()">short cuts ᨈ</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!--Nav-->
        <div class="NavScrin" id="NavScrin">
            
            <div>
                <div style="width: 100%;
                display: flex
            ;
                width: 100%;
                justify-content: space-between;
                align-items: baseline;
            ">
            <div>RJdesidia Editing Director Id Tool</div>
                    
                    <button id="shortcutvivercloas" class="SCB" style="width: 80px; margin-left: 5px;" onclick="closeSC()">ᨆ</button>
                    
                </div>
                <div style="padding-left: 20px; padding-bottom: 10px; margin-top: 50px;" >Горячие клавиши</div>
                <div class="SC">
                    <div class="SCR">
                        <div class="SCI">
                            Воспроизведение/Пауза
                        </div>
                        <div class="SCB">
                            Space
                        </div>
                    </div>
                    <div class="SCR">
                        <div class="SCI">
                            Кадр назад
                        </div>
                        <div class="SCB">
                            ←
                        </div>
                    </div>
                    <div class="SCR">
                        <div class="SCI">
                            Кадр вперед
                        </div>
                        <div class="SCB">
                            →
                        </div>
                    </div>
                    <div class="SCR">
                        <div class="SCI">
                            К точке входа
                        </div>
                        <div class="SCB">
                            U
                        </div>
                    </div>
                    <div class="SCR">
                        <div class="SCI">
                            К точке выхода
                        </div>
                        <div class="SCB">
                            P
                        </div>
                    </div>
                    <div class="SCR">
                        <div class="SCI">
                            Установить точку входа
                        </div>
                        <div class="SCB">
                            I
                        </div>
                    </div>
                    <div class="SCR">
                        <div class="SCI">
                            Установить точку выхода
                        </div>
                        <div class="SCB">
                            O
                        </div>
                    </div>
                    <div class="SCR">
                        <div class="SCI">
                            Петля
                        </div>
                        <div class="SCB">
                            L
                        </div>
                    </div>
                    <div class="SCR">
                        <div class="SCI">
                            Копировать текушие время
                        </div>
                        <div class="SCB">
                            X
                        </div>
                    </div>
                    <div class="SCR">
                        <div class="SCI">
                            Копировать In/Out
                        </div>
                        <div class="SCB">
                            C
                        </div>
                    </div>
                </div>
            </div>
           
            </div>
        </div>

        <script>
            const video = document.getElementById('video');
            const fileInput = document.getElementById('fileInput');
            const fileList = document.getElementById('fileList');
            const progressBar = document.getElementById('progressBar');
            const progressFill = document.getElementById('progressFill');
            const loopArea = document.getElementById('loopArea');
            const setInButton = document.getElementById('setIn');
            const setOutButton = document.getElementById('setOut');
            const goToInButton = document.getElementById('goToIn');
            const goToOutButton = document.getElementById('goToOut');
            const stepBackButton = document.getElementById('stepBack');
            const stepForwardButton = document.getElementById('stepForward');
            const playPauseButton = document.getElementById('playPause');
            const toggleLoopButton = document.getElementById('toggleLoop');
            const copyTCButton = document.getElementById('copyTC');
            const copyInOutButton = document.getElementById('copyInOut');
            const currentTimeDisplay = document.getElementById('currentTime');
            const inTimeDisplay = document.getElementById('inTime');
            const outTimeDisplay = document.getElementById('outTime');

            let inPoint = null;
            let outPoint = null;
            let fps = 25;
            let loop = false;

            fileInput.addEventListener('change', (event) => {
                fileList.innerHTML = '';
                Array.from(event.target.files).forEach(file => {
                    const div = document.createElement('div');
                    div.className = 'file-item';
                    div.textContent = file.name;

                    // FPS Selector
                    const fpsSelector = document.createElement('select');
                    fpsSelector.className = 'fps-selector';
                    [24, 25, 30, 50, 60].forEach(fpsValue => {
                        const option = document.createElement('option');
                        option.value = fpsValue;
                        option.textContent = `${fpsValue} FPS`;
                        fpsSelector.appendChild(option);
                    });

                    fpsSelector.addEventListener('change', () => {
                        fps = parseInt(fpsSelector.value);
                    });

                    div.appendChild(fpsSelector);
                    div.addEventListener('click', () => {
                        video.src = URL.createObjectURL(file);
                        video.load();
                        inPoint = null;
                        outPoint = null;
                        updateInOutDisplay();
                    });
                    fileList.appendChild(div);
                });
            });

            progressBar.addEventListener('click', (e) => {
                const rect = progressBar.getBoundingClientRect();
                const clickPos = (e.clientX - rect.left) / rect.width;
                video.currentTime = clickPos * video.duration;
            });

            video.addEventListener('timeupdate', () => {
                currentTimeDisplay.textContent = `Timecode: ${formatTime(video.currentTime)}`;
                const current = video.currentTime / video.duration;
                progressFill.style.width = `${current * 100}%`;
                if (loop && inPoint !== null && outPoint !== null) {
                    if (video.currentTime >= outPoint) {
                        video.currentTime = inPoint;
                    }
                }
            });

            setInButton.addEventListener('click', () => {
                inPoint = video.currentTime;
                updateInOutDisplay();
                updateLoopArea();
            });

            setOutButton.addEventListener('click', () => {
                outPoint = video.currentTime;
                updateInOutDisplay();
                updateLoopArea();
            });

            function updateLoopArea() {
                if (inPoint !== null && outPoint !== null) {
                    const loopStart = (inPoint / video.duration) * 100;
                    const loopEnd = (outPoint / video.duration) * 100;
                    loopArea.style.left = `${loopStart}%`;
                    loopArea.style.width = `${loopEnd - loopStart}%`;
                }
            }


            goToInButton.addEventListener('click', () => {
                if (inPoint !== null) video.currentTime = inPoint;
            });

            goToOutButton.addEventListener('click', () => {
                if (outPoint !== null) video.currentTime = outPoint - 0.01;
            });

            stepBackButton.addEventListener('click', () => {
                video.currentTime = Math.max(0, video.currentTime - 1 / fps);
            });

            stepForwardButton.addEventListener('click', () => {
                video.currentTime = Math.min(video.duration, video.currentTime + 1 / fps);
            });

            playPauseButton.addEventListener('click', () => {
                if (video.paused) video.play();
                else video.pause();
            });

            toggleLoopButton.addEventListener('click', () => {
                loop = !loop;

            });

            copyTCButton.addEventListener('click', () => {
                navigator.clipboard.writeText(formatTime(video.currentTime));
            });

            copyInOutButton.addEventListener('click', () => {
                if (inPoint !== null && outPoint !== null) {
                    const inTime = formatTime(inPoint);
                    const outTime = formatTime(outPoint);
                    navigator.clipboard.writeText(`${inTime}\t${outTime}`);
                }
            });

            function updateInOutDisplay() {
                inTimeDisplay.textContent = `In: ${inPoint !== null ? formatTime(inPoint) : '--:--:--:--'}`;
                outTimeDisplay.textContent = `Out: ${outPoint !== null ? formatTime(outPoint) : '--:--:--:--'}`;
            }

            function formatTime(seconds) {
                const h = Math.floor(seconds / 3600).toString().padStart(2, '0');
                const m = Math.floor((seconds % 3600) / 60).toString().padStart(2, '0');
                const s = Math.floor(seconds % 60).toString().padStart(2, '0');
                const f = Math.floor((seconds % 1) * fps).toString().padStart(2, '0');
                return `${h}:${m}:${s}:${f}`;
            }


        </script>
        <script>
            // Объект для привязки кнопок к клавишам
            const keyBindings = {
                ArrowLeft: "stepBack", // Левая стрелка - шаг назад
                ArrowRight: "stepForward", // Правая стрелка - шаг вперёд
                Space: "playPause", // Пробел - воспроизведение/пауза
                KeyU: "goToIn", // Клавиша "U" - переход к точке In
                KeyP: "goToOut", // Клавиша "P" - переход к точке Out
                KeyL: "toggleLoop", // Клавиша "L" - переключение Loop
                KeyI: "setIn", // Клавиша "I" - установка точки In
                KeyO: "setOut", // Клавиша "O" - установка точки Out
                KeyC: "copyTC", // Клавиша "C" - копировать Timecode
                KeyX: "copyInOut" // Клавиша "X" - копировать In/Out
            };

            // Функция обработки нажатия клавиш
            document.addEventListener("keydown", (event) => {
                const buttonId = keyBindings[event.code]; // Получить ID кнопки из привязки
                if (buttonId) {
                    // Найти кнопку и сымитировать клик
                    const button = document.getElementById(buttonId);
                    if (button) {
                        button.click(); // Выполнить действие, привязанное к кнопке
                        button.style.opacity = 0.7; // Визуальная индикация нажатия
                        setTimeout(() => button.style.opacity = 1, 200); // Возврат к обычному состоянию
                    }
                }
            });

            // Пример добавления кликов для демонстрации
            document.querySelectorAll(".navigatin-booton, button").forEach(button => {
                button.addEventListener("click", () => {
                    console.log(`Кнопка "${button.id}" нажата`);
                });
            });
        </script>
        <script>

             function openSC() {
                document.getElementById("NavScrin").style.bottom = "0%";
            }

            function closeSC() {
                document.getElementById("NavScrin").style.bottom = "-25%";
            }
        </script>

</body>
<script>
link.addEventListener('click', () => {
        window.open('https://linktr.ee/rjdesidia', '_blank');})
        </script>

</html>